# MongoDB Database Schema

This document describes the MongoDB collections and schema design for the Julius Baer AML Platform.

## Collections

### 1. alerts

Stores all AML alerts generated by the system.

```javascript
{
  _id: ObjectId,
  alert_id: "ALT-789",                    // Unique alert identifier
  priority: "CRITICAL",                    // CRITICAL, HIGH, MEDIUM, LOW
  client: "ABC Trading Ltd",
  client_id: "CLI-456",
  type: "Integrated Alert: Transaction + Document Anomaly",
  amount: 150000,
  currency: "CHF",
  risk_score: 95,                          // 0-100
  status: "pending",                       // pending, investigating, resolved
  timestamp: ISODate("2025-10-30T09:15:00Z"),
  country: "Switzerland",
  transaction_type: "Real Estate Purchase",
  counterparty: "Luxury Properties Zurich AG",
  purpose: "Purchase of residential property - Zurich",
  date: "30/10/2025",
  
  // Agent analysis results
  agent_findings: [
    {
      agent_name: "Agent 1: Regulatory Watcher",
      agent_type: "Regulatory Watcher",
      priority: "critical",
      finding: "Transaction violates FINMA Circular 2025-04...",
      regulation: "Regulation: FINMA Circular 2025-04"
    }
  ],
  
  // Document issues detected
  document_issues: [
    {
      type: "tampering",
      description: "Purchase price field shows metadata inconsistency",
      page: 8
    }
  ],
  
  // Associated document
  document_id: ObjectId,
  document_url: "/documents/abc-trading-purchase-agreement.pdf",
  
  // Metadata
  created_at: ISODate("2025-10-30T09:15:00Z"),
  updated_at: ISODate("2025-10-30T09:15:00Z"),
  created_by: "system",
  assigned_to: "Ana Rodriguez"
}
```

**Indexes:**
- `alert_id` (unique)
- `risk_score` (descending)
- `timestamp` (descending)
- `status`
- `client_id`

### 2. transactions

Stores all financial transactions for pattern analysis.

```javascript
{
  _id: ObjectId,
  transaction_id: "TXN-12345",
  client_id: "CLI-456",
  client_name: "ABC Trading Ltd",
  amount: 150000,
  currency: "CHF",
  transaction_type: "Real Estate Purchase",
  counterparty: "Luxury Properties Zurich AG",
  counterparty_country: "Switzerland",
  purpose: "Purchase of residential property",
  timestamp: ISODate("2025-10-30T09:00:00Z"),
  
  // Risk indicators
  risk_flags: ["high_value", "real_estate", "cross_border"],
  risk_score: 85,
  
  // Related entities
  alert_id: "ALT-789",                     // If alert was generated
  document_ids: [ObjectId, ObjectId],
  
  // Metadata
  created_at: ISODate("2025-10-30T09:00:00Z"),
  processed_at: ISODate("2025-10-30T09:15:00Z")
}
```

**Indexes:**
- `transaction_id` (unique)
- `client_id`
- `timestamp` (descending)
- `risk_score` (descending)
- `alert_id`

### 3. documents

Stores document metadata and analysis results.

```javascript
{
  _id: ObjectId,
  document_id: "DOC-789",
  document_name: "Swiss_Home_Purchase_Agreement.pdf",
  document_type: "purchase_agreement",
  file_path: "/storage/documents/2025/10/doc-789.pdf",
  file_size: 2458624,                      // bytes
  mime_type: "application/pdf",
  
  // Associated entities
  transaction_id: "TXN-12345",
  alert_id: "ALT-789",
  client_id: "CLI-456",
  
  // Forensics analysis
  analysis_status: "completed",            // pending, processing, completed, failed
  analysis_timestamp: ISODate("2025-10-30T09:10:00Z"),
  
  issues_detected: [
    {
      type: "tampering",
      severity: "critical",
      description: "Purchase price field shows metadata inconsistency",
      page: 8,
      confidence: 0.95
    }
  ],
  
  // Document metadata
  pages: 12,
  created_date: "2025-10-28",
  modified_date: "2025-10-29",
  author: "Unknown",
  
  // System metadata
  uploaded_at: ISODate("2025-10-30T09:05:00Z"),
  uploaded_by: "ABC Trading Ltd",
  analyzed_by: "Document Forensics Agent"
}
```

**Indexes:**
- `document_id` (unique)
- `transaction_id`
- `alert_id`
- `client_id`
- `analysis_status`

### 4. audit_logs

Complete audit trail of all system actions.

```javascript
{
  _id: ObjectId,
  log_id: "LOG-12345",
  timestamp: ISODate("2025-10-30T09:15:00Z"),
  
  // Actor information
  user: "Ana Rodriguez",
  user_id: "USR-001",
  user_role: "Compliance Officer",
  
  // Action details
  action: "Alert Viewed",
  action_type: "view",                     // create, view, update, delete, analyze
  entity_type: "alert",                    // alert, transaction, document
  entity_id: "ALT-789",
  
  // Additional context
  details: "Compliance officer viewed alert details",
  ip_address: "192.168.1.100",
  user_agent: "Mozilla/5.0...",
  
  // Changes (for update actions)
  changes: {
    field: "status",
    old_value: "pending",
    new_value: "investigating"
  }
}
```

**Indexes:**
- `timestamp` (descending)
- `entity_id`
- `user_id`
- `action_type`

### 5. clients

Client information for reference and risk profiling.

```javascript
{
  _id: ObjectId,
  client_id: "CLI-456",
  client_name: "ABC Trading Ltd",
  client_type: "corporate",                // individual, corporate
  
  // Contact information
  country: "Switzerland",
  city: "Zurich",
  registration_number: "CHE-123.456.789",
  
  // Risk profile
  risk_level: "high",                      // low, medium, high
  pep_status: false,                       // Politically Exposed Person
  sanctions_check: "clear",
  
  // Transaction statistics
  total_transactions: 127,
  total_volume: 8500000,
  avg_transaction_amount: 66929,
  
  // Account information
  account_opened: ISODate("2020-01-15T00:00:00Z"),
  relationship_manager: "John Smith",
  
  // Metadata
  created_at: ISODate("2020-01-15T00:00:00Z"),
  updated_at: ISODate("2025-10-30T00:00:00Z"),
  last_review: ISODate("2025-09-01T00:00:00Z")
}
```

**Indexes:**
- `client_id` (unique)
- `risk_level`
- `country`

## Relationships

```
clients (1) ──< (N) transactions
transactions (1) ──< (N) documents
transactions (1) ──< (1) alerts
alerts (1) ──< (N) audit_logs
```

## Data Retention

- **alerts**: Retain for 10 years (regulatory requirement)
- **transactions**: Retain for 10 years (regulatory requirement)
- **documents**: Retain for 10 years (regulatory requirement)
- **audit_logs**: Retain indefinitely
- **clients**: Retain while active + 10 years after closure

## Backup Strategy

- Daily full backups
- Point-in-time recovery enabled
- Backup retention: 90 days
- Geographic redundancy: Primary + 2 replicas

## Security

- Encryption at rest enabled
- Encryption in transit (TLS 1.3)
- Field-level encryption for sensitive data
- Role-based access control (RBAC)
- Audit logging for all data access

