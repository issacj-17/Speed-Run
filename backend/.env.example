# FastAPI Document Corroboration Backend - Environment Configuration
# Copy this file to .env and update with your settings

# =============================================================================
# Application Settings
# =============================================================================
APP_NAME="Speed-Run AML Platform"
VERSION="1.0.0"

# =============================================================================
# CORS Settings (Frontend Integration)
# =============================================================================
ALLOWED_ORIGINS=["http://localhost:3000","http://localhost:5173","http://localhost:8080"]

# =============================================================================
# Database Settings (PostgreSQL)
# =============================================================================
# PostgreSQL connection string (async driver)
DATABASE_URL="postgresql+asyncpg://speedrun:speedrun@localhost:5432/speedrun_aml"

# Connection pool settings
DB_POOL_SIZE=20
DB_MAX_OVERFLOW=10

# SQL query logging (set to true for debugging)
DB_ECHO=false

# Test environment flag (set to true when running tests)
TESTING=false

# =============================================================================
# Redis Settings (Cache)
# =============================================================================
# Redis connection string
REDIS_URL="redis://localhost:6379/0"

# Redis connection pool settings
REDIS_MAX_CONNECTIONS=50
REDIS_SOCKET_TIMEOUT=5
REDIS_SOCKET_CONNECT_TIMEOUT=5

# Cache feature toggle
CACHE_ENABLED=true

# Default cache TTL (Time-To-Live) in seconds
CACHE_DEFAULT_TTL=3600  # 1 hour

# =============================================================================
# Cache TTL Settings (in seconds)
# =============================================================================
# Document parsing results cache (24 hours)
CACHE_TTL_DOCUMENT_PARSING=86400

# OCR results cache (48 hours)
CACHE_TTL_OCR=172800

# Image analysis results cache (24 hours)
CACHE_TTL_IMAGE_ANALYSIS=86400

# Validation results cache (12 hours)
CACHE_TTL_VALIDATION=43200

# =============================================================================
# Logging Settings
# =============================================================================
# Log level: DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_LEVEL="INFO"

# Optional: Log file path (leave empty for console-only logging)
LOG_FILE=""

# =============================================================================
# File Upload Settings
# =============================================================================
MAX_FILE_SIZE=10485760  # 10MB (in bytes)
UPLOAD_DIR="/tmp/uploads"

# Allowed file extensions (comma-separated or as JSON array)
ALLOWED_EXTENSIONS=[".pdf",".png",".jpg",".jpeg",".tiff",".bmp",".docx"]

# =============================================================================
# OCR Settings
# =============================================================================
OCR_ENGINE="docling"
OCR_LANGUAGE="en"

# =============================================================================
# Document Corroboration Settings
# =============================================================================

# Audit log directory (will be created if doesn't exist)
AUDIT_LOG_PATH="/tmp/corroboration_audit"

# Feature flags
ENABLE_REVERSE_IMAGE_SEARCH=false  # Set to true when API keys are configured
ENABLE_ADVANCED_FORENSICS=true

# Risk scoring thresholds (0-100 scale)
RISK_THRESHOLD_LOW=25.0
RISK_THRESHOLD_MEDIUM=50.0
RISK_THRESHOLD_HIGH=75.0

# =============================================================================
# Image Forensic Analysis - Tampering Detection Thresholds
# =============================================================================

# ELA (Error Level Analysis) Thresholds
# These control the sensitivity of compression inconsistency detection
TAMPERING_ELA_ANOMALY_THRESHOLD=0.15      # Ratio threshold for ELA anomalies (0-1)
TAMPERING_ELA_VERY_LOW=15.0               # ELA variance threshold for very low compression
TAMPERING_ELA_LOW=40.0                    # ELA variance threshold for low compression
TAMPERING_ELA_HIGH=600.0                  # ELA variance threshold for high compression
TAMPERING_ELA_VERY_HIGH=1000.0            # ELA variance threshold for very high compression

# Advanced Forensic Detection Thresholds
# These control the sensitivity of advanced tampering detection methods
TAMPERING_NOISE_RATIO_MAX=3.0             # Maximum acceptable noise ratio between regions
TAMPERING_EDGE_CONSISTENCY_DIFF=20        # Maximum edge detector difference (pixels)
TAMPERING_RESAMPLING_FFT_PEAK_RATIO=8.0   # FFT peak ratio for resampling detection
TAMPERING_COLOR_CORR_LOW=0.85             # Minimum color channel correlation
TAMPERING_MEDIAN_FILTER_THRESHOLD=1.0     # Threshold for median filter detection

# Clone Detection Thresholds
# These control how the system detects duplicated/cloned regions
TAMPERING_CLONE_REGION_SIZE=32            # Size of regions for clone detection (pixels)
TAMPERING_CLONE_DUPLICATE_RATIO_THRESHOLD=0.05  # Threshold for duplicate region ratio
TAMPERING_CLONE_DISTANCE_MIN_BLOCKS=2     # Minimum distance between cloned blocks

# Compression Analysis Thresholds
TAMPERING_COMPRESSION_VARIANCE_THRESHOLD=1000.0  # Threshold for compression variance

# =============================================================================
# Risk Score Normalization (Social Media Compression)
# =============================================================================
# These control how much to reduce risk scores for images compressed by social media
# Higher values = more reduction (more lenient for social media images)
RISK_NORMALIZATION_REDUCTION_LOW=0.4      # 40% reduction for heavy compression (WhatsApp)
RISK_NORMALIZATION_REDUCTION_MEDIUM=0.5   # 50% reduction for medium compression
RISK_NORMALIZATION_REDUCTION_HIGH=0.65    # 65% reduction for light compression

# =============================================================================
# External API Keys (Optional)
# =============================================================================

# Google Cloud Vision API
# Get key: https://console.cloud.google.com/
# Free tier: 1000 requests/month
GOOGLE_VISION_API_KEY=""

# TinEye Reverse Image Search
# Get key: https://services.tineye.com/developers
# Pricing: Starting at $200 for 5000 searches
TINEYE_API_KEY=""
TINEYE_API_SECRET=""

# Bing Visual Search API
# Get key: https://portal.azure.com/
# Free tier: 1000 transactions/month
BING_VISUAL_SEARCH_KEY=""

# Hive AI Detection
# Get key: https://thehive.ai/
# Detects AI-generated images and deepfakes
HIVE_AI_API_TOKEN=""

# Sightengine Image Moderation & Forensics
# Get key: https://sightengine.com/
# Free tier available
SIGHTENGINE_API_USER=""
SIGHTENGINE_API_SECRET=""

# AWS Rekognition (Alternative)
# Get keys: https://console.aws.amazon.com/
# Free tier: 5000 images/month
AWS_ACCESS_KEY_ID=""
AWS_SECRET_ACCESS_KEY=""
AWS_REGION="us-east-1"

# LanguageTool API (Advanced Spell Checking)
# Get key: https://languagetool.org/dev
# Free tier available
LANGUAGETOOL_API_KEY=""

# =============================================================================
# Development Settings
# =============================================================================

# Set to true for development mode (more verbose logging)
DEBUG=false

# Log level: DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_LEVEL="INFO"

# =============================================================================
# Production Settings (Uncomment for production)
# =============================================================================

# Use production audit log path
# AUDIT_LOG_PATH="/var/log/corroboration"

# Increase file size limit for production
# MAX_FILE_SIZE=52428800  # 50MB

# Production CORS origins
# ALLOWED_ORIGINS=["https://yourdomain.com"]

# Enable reverse image search in production
# ENABLE_REVERSE_IMAGE_SEARCH=true

# =============================================================================
# Notes
# =============================================================================

# 1. This file should NOT be committed to version control
# 2. Add .env to your .gitignore file
# 3. See IMPLEMENTATION_PROGRESS.md for API key setup instructions
# 4. See SETUP_GUIDE.md for installation instructions
# 5. All external API keys are optional - the system works without them
# 6. Default values are used if environment variables are not set
